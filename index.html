<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Enhanced Resume Builder</title>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600;700&family=Poppins:wght@300;400;600;700&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">

  <!-- Font Awesome for Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" integrity="sha512-Fo3rlrZj/k7ujlRzB+Yf8+r1oA7wF5p4h+xQ82yN5tGgqf0f5j/fFzL+Jv/H5vG6F5e/R8E5s6K3p0q6zK8w==" crossorigin="anonymous" referrerpolicy="no-referrer" />

  <!-- html2pdf CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>

  <style>
    :root{
      --bg:#f4f6fb;
      --card:#fff;
      --muted:#6b7280;
      --accent:#0f62fe;
      --shadow: 0 6px 18px rgba(11, 22, 39, 0.06);
      --max-width:1200px;
      --border-light: #e6e9ef;
      --border-dash: #eef2ff;
      --text-dark: #111827;
      --text-light: #f9fafb;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: "Open Sans", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background:var(--bg);
      color:var(--text-dark);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      padding:24px;
      display:flex;
      justify-content:center;
    }

    .app{
      width:100%;
      max-width:var(--max-width);
      display:grid;
      grid-template-columns: 420px 1fr;
      gap:20px;
      align-items:start;
    }

    /* LEFT: Form controls */
    .panel{
      background:var(--card);
      border-radius:12px;
      padding:18px;
      box-shadow:var(--shadow);
      height:calc(100vh - 48px);
      overflow-y:auto; /* Changed to auto for scrollbar only when needed */
      display:flex; /* Use flex for internal layout */
      flex-direction:column;
    }
    h2{margin:0 0 12px 0;font-size:20px; color:var(--accent)} /* Larger, accented title */
    .panel h3{font-size:16px; margin:20px 0 10px 0; color:var(--text-dark); border-bottom:1px solid var(--border-light); padding-bottom:8px;} /* Clearer section titles */
    label{display:block;font-size:13px;margin-top:10px;color:var(--muted); font-weight:600;} /* Bold labels */
    input[type="text"], input[type="email"], input[type="tel"], textarea, select{
      width:100%;
      padding:10px 12px;
      margin-top:6px;
      border-radius:8px;
      border:1px solid var(--border-light);
      font-size:14px;
      background: #fafbff;
      transition:border-color 0.2s, box-shadow 0.2s;
    }
    input[type="text"]:focus, input[type="email"]:focus, input[type="tel"]:focus, textarea:focus, select:focus{
      outline:none;
      border-color:var(--accent);
      box-shadow:0 0 0 3px rgba(15,98,254,0.1);
    }
    textarea{min-height:76px; resize:vertical;}
    .row{display:flex;gap:8px}
    .small{flex:1}
    .section{
      margin-top:14px;
      padding-top:12px;
      /* border-top:1px dashed var(--border-dash); */ /* Removed as h3 creates separation */
    }
    .controls{display:flex; gap:8px; margin-top:16px; flex-wrap:wrap; align-items:center;} /* Better spacing for buttons */
    button{
      padding:10px 14px;
      border-radius:8px;
      border:0;
      font-weight:600;
      cursor:pointer;
      transition:transform 0.1s ease, background 0.2s, color 0.2s, box-shadow 0.2s;
      display:inline-flex;
      align-items:center;
      gap:6px;
    }
    button:hover{transform:translateY(-1px);}
    .btn-primary{background:var(--accent); color:#fff; box-shadow:0 6px 14px rgba(15,98,254,0.12)}
    .btn-primary:hover{background:darken(var(--accent), 5%);}
    .btn-ghost{background:transparent; border:1px solid var(--border-light); color:var(--text-dark)}
    .btn-ghost:hover{background:var(--bg);}

    /* Dynamic section styling */
    .dynamic-item {
        background: #f9fbfd;
        border: 1px solid var(--border-light);
        border-radius: 8px;
        padding: 12px;
        margin-bottom: 12px;
        position: relative; /* For positioning remove button */
    }
    .dynamic-item-controls {
        display: flex;
        justify-content: flex-end; /* Align to right */
        gap: 8px;
        margin-top: 10px;
    }
    .btn-add {
        padding: 8px 12px;
        font-size: 13px;
        font-weight: 600;
        border-radius: 6px;
        cursor: pointer;
        border: 1px solid var(--accent);
        background: var(--card);
        color: var(--accent);
        transition: all 0.2s ease;
        margin-top:10px;
    }
    .btn-add:hover {
        background: #e9f0ff;
    }
    .btn-remove {
        position: absolute; /* Position relative to dynamic-item */
        top: 10px;
        right: 10px;
        padding: 4px 8px; /* Smaller padding */
        font-size: 11px;
        border-radius: 5px;
        cursor: pointer;
        border: 1px solid #fca5a5; /* Light red border */
        background: #fee2e2; /* Light red background */
        color: #ef4444; /* Red for remove */
        transition: all 0.2s ease;
        line-height: 1; /* Keep icon centered */
    }
    .btn-remove:hover {
        background: #fecaca; /* Slightly darker red on hover */
        border-color: #ef4444;
    }
    .btn-icon { /* Style for icon-only buttons */
      padding: 6px 8px;
      width: 30px;
      height: 30px;
      display: inline-flex;
      justify-content: center;
      align-items: center;
    }
    .btn-icon i {
      font-size: 14px;
    }

    /* RIGHT: Preview area */
    .preview-wrap{
      display:flex;
      flex-direction:column;
      gap:12px;
      height:calc(100vh - 48px);
      overflow:hidden; /* Prevent scrollbar on wrapper */
    }
    .preview-top{display:flex;justify-content:space-between;gap:8px;align-items:center}
    .preview{
      background:var(--card); padding:22px; border-radius:12px; box-shadow:var(--shadow); overflow-y:auto; flex:1; /* Only vertical scroll */
      min-height:640px;
      width:100%;
    }

    /* Template container common classes */
    .resume{
      width:210mm; /* A4 width for PDF */
      max-width:780px; /* Max width for preview */
      margin: 0 auto;
      color:var(--text-dark);
      background:transparent;
      min-height:297mm; /* Ensure it visually looks like A4 height */
      padding: 10mm; /* Internal padding for A4 */
    }
    .r-header{display:flex;align-items:center;gap:16px}
    .r-name{font-weight:700}
    .r-contact{font-size:13px; color:var(--muted); word-break: break-all;} /* Allow links to break */
    .r-contact a {color:var(--muted); text-decoration: none;}
    .r-contact a:hover {text-decoration: underline;}
    .section-title{margin-top:18px;font-weight:700;font-size:16px; padding-bottom:4px; border-bottom:1px solid var(--border-light); margin-bottom:10px;} /* Stronger section titles */
    .muted{color:var(--muted);font-size:13px}
    ul{margin:6px 0 0 20px; padding:0; list-style-type:disc;} /* Bullet points */
    ul li {margin-bottom:4px; padding-left: 0;} /* No extra padding for li */
    .item-title{font-weight:600; margin-bottom:2px;}
    .small-muted{font-size:13px;color:#6b7280; line-height:1.4;}
    .line{height:1px;background:#e6e9ef;margin:12px 0;border-radius:2px}

    .resume-item { margin-bottom: 12px; }
    .resume-item:last-child { margin-bottom: 0; }
    .resume-item.no-content { display: none; } /* Hide empty dynamic items in preview */

    /* TEMPLATE 1 — Classic (Times-like feel) */
    .tpl-classic{
      font-family: "Times New Roman", Times, serif;
    }
    .tpl-classic .r-name{font-size:28px}
    .tpl-classic .section-title{font-size:17px;border-bottom:2px solid #e6e9ef;padding-bottom:6px}
    .tpl-classic ul{list-style-type:circle;} /* Classic specific bullet style */

    /* TEMPLATE 2 — Modern (Open Sans) */
    .tpl-modern{
      font-family: "Open Sans", Arial, sans-serif;
      color:#0f1724;
    }
    .tpl-modern .r-name{font-size:26px; color:#0f1724}
    .tpl-modern .r-head{display:flex;justify-content:space-between;align-items:flex-start}
    .tpl-modern .section-title{color:var(--accent); border-bottom:none;}
    .tpl-modern ul{list-style-type:square;}

    /* TEMPLATE 3 — Elegant (Georgia) */
    .tpl-elegant{
      font-family: Georgia, "Times New Roman", serif;
      color:#111827;
    }
    .tpl-elegant .r-name{font-size:26px; border-bottom:1px solid var(--border-light); padding-bottom:5px; margin-bottom:5px;}
    .tpl-elegant .r-contact{margin-top:0 !important;}
    .tpl-elegant .section-title{font-size:16px; color:#374151; border-left:4px solid #374151; padding-left:8px; border-bottom:none;}
    .tpl-elegant ul{list-style-type:disclosure-closed;}

    /* TEMPLATE 4 — Creative (Poppins + color) */
    .tpl-creative{
      font-family: "Poppins", "Open Sans", sans-serif;
      color:#0b1020;
    }
    .tpl-creative .r-name{font-size:28px; color:#111827}
    .tpl-creative .header-accent{background:#f59e0b;padding:8px 12px;border-radius:8px;color:white;font-weight:700; display:inline-block; margin-bottom:10px;}
    .tpl-creative .section-title{color:var(--accent); border-bottom:2px solid var(--accent); padding-bottom:5px; margin-bottom:10px;}
    .tpl-creative ul{list-style-type:circle;} /* Use circle for creative */

    /* TEMPLATE 5 — Compact (Roboto, tighter spacing) */
    .tpl-compact{
      font-family: "Roboto", sans-serif;
      font-size:13px;
      color:#0f1724;
    }
    .tpl-compact .r-name{font-size:22px}
    .tpl-compact .section-title{font-size:14px;margin-top:10px; border-bottom:1px solid #ddd; padding-bottom:4px; margin-bottom:8px;}
    .tpl-compact ul{margin:4px 0 0 16px;}
    .tpl-compact .resume-item { margin-bottom: 8px; }


    /* small responsive tweaks */
    @media (max-width:980px){
      .app{grid-template-columns:1fr; padding-bottom:40px; gap:16px;}
      .panel{height:auto; max-height:600px; padding:16px; border-radius:8px;} /* Adjust max-height and padding */
      .preview-wrap{height:auto;}
      .preview{padding:16px; min-height:400px; border-radius:8px;}
      .resume{max-width:100%; width:100%; padding: 8mm;} /* Adjust A4 padding on small screens */
      body{padding:16px;}
      h2{font-size:18px;}
      .panel h3{font-size:15px;}
      button{padding:8px 12px; font-size:13px;}
      .btn-icon{width:28px; height:28px;}
      .btn-icon i{font-size:12px;}
    }

  </style>
</head>
<body>
  <div class="app">
    <!-- LEFT: Controls -->
    <div class="panel" id="controls">
      <h2>Resume Builder</h2>

      <label for="templateSelect">Choose Template</label>
      <select id="templateSelect">
        <option value="classic">Template 1 — Classic (Serif, Formal)</option>
        <option value="modern">Template 2 — Modern (Sans-serif, Clean)</option>
        <option value="elegant">Template 3 — Elegant (Serif, Sophisticated)</option>
        <option value="creative">Template 4 — Creative (Poppins, Accented)</option>
        <option value="compact">Template 5 — Compact (Roboto, Concise)</option>
      </select>

      <h3>Personal Details</h3>
      <div class="section">
        <label for="name">Full Name</label>
        <input id="name" type="text" placeholder="e.g., Priya Sharma" />

        <label for="title">Professional Title</label>
        <input id="title" type="text" placeholder="e.g., Computer Science Student" />

        <div class="row">
          <div class="small">
            <label for="email">Email</label>
            <input id="email" type="email" placeholder="name@example.com" />
          </div>
          <div class="small">
            <label for="phone">Phone</label>
            <input id="phone" type="tel" placeholder="+91 99999 99999" />
          </div>
        </div>

        <label for="location">Location (City, Country)</label>
        <input id="location" type="text" placeholder="Bengaluru, India" />

        <label for="links">Links (LinkedIn, Portfolio, GitHub - comma-separated)</label>
        <input id="links" type="text" placeholder="linkedin.com/in/you, github.com/you" />

        <label for="summary" style="margin-top:20px;">About / Professional Summary</label>
        <textarea id="summary" placeholder="A concise (2-3 lines) summary of your skills and aspirations."></textarea>
      </div>

      <h3>Education</h3>
      <div class="section" id="educationSection">
        <!-- Education items will be injected here -->
        <button class="btn-add" data-section="education"><i class="fas fa-plus"></i> Add Education</button>
      </div>

      <h3>Experience / Internships</h3>
      <div class="section" id="experienceSection">
        <!-- Experience items will be injected here -->
        <button class="btn-add" data-section="experience"><i class="fas fa-plus"></i> Add Experience</button>
      </div>

      <h3>Projects</h3>
      <div class="section" id="projectsSection">
        <!-- Project items will be injected here -->
        <button class="btn-add" data-section="projects"><i class="fas fa-plus"></i> Add Project</button>
      </div>

      <h3>Skills & Certifications</h3>
      <div class="section">
        <label for="technicalSkills">Technical Skills (comma separated)</label>
        <input id="technicalSkills" type="text" placeholder="Python, C, React, Git, Machine Learning" />

        <label for="softSkills">Soft Skills (comma separated)</label>
        <input id="softSkills" type="text" placeholder="Teamwork, Communication, Problem-solving" />

        <label for="languages">Languages (comma separated)</label>
        <input id="languages" type="text" placeholder="English (Fluent), Hindi (Native), French (Basic)" />

        <label for="certsAwards" style="margin-top:20px;">Certifications / Awards (comma separated)</label>
        <input id="certsAwards" type="text" placeholder="AWS Cloud Practitioner; Hackathon Winner 2023" />
      </div>

      <div class="controls">
        <button class="btn-primary" id="downloadBtn"><i class="fas fa-download"></i> Download PDF</button>
        <button class="btn-ghost" id="saveBtn"><i class="fas fa-save"></i> Save (Local)</button>
        <button class="btn-ghost" id="clearBtn"><i class="fas fa-trash-alt"></i> Clear All</button>
      </div>
      <div class="note">Tip: Your data auto-saves locally in your browser.</div>
    </div>

    <!-- RIGHT: Preview -->
    <div class="preview-wrap">
      <div class="preview-top">
        <div style="font-size:14px;color:var(--text-dark);font-weight:700">Live Preview</div>
        <div style="color:var(--muted);font-size:13px">A4 / PDF friendly • Choose template then Download</div>
      </div>

      <div class="preview" id="previewArea">
        <!-- The resume preview will be injected here -->
        <div id="resume" class="resume tpl-classic" role="document">
          <!-- Default content structure for dynamic updates -->
          <div class="r-header r-head">
            <div>
              <div class="r-name" id="r_name">Your Name</div>
              <div class="r-contact" id="r_title">Professional Title</div>
              <div style="margin-top:8px" class="r-contact" id="r_contact">email • phone • location</div>
            </div>
          </div>

          <div class="line"></div>

          <div id="r_summary" class="muted">A brief summary about yourself, highlighting key skills and career goals.</div>

          <div class="section-title">Education</div>
          <div id="r_education_items">
            <!-- Dynamic education items will render here -->
            <div class="resume-item muted" data-placeholder-type="education">
              <div class="item-title">University Name — Degree (Years)</div>
              <div class="small-muted">CGPA, key coursework, relevant achievements.</div>
            </div>
          </div>

          <div class="section-title">Experience</div>
          <div id="r_experience_items">
            <!-- Dynamic experience items will render here -->
            <div class="resume-item muted" data-placeholder-type="experience">
              <div class="item-title">Role — Company (Dates)</div>
              <div class="small-muted">
                <ul>
                  <li>Accomplishment 1</li>
                  <li>Accomplishment 2</li>
                </ul>
              </div>
            </div>
          </div>

          <div class="section-title">Projects</div>
          <div id="r_projects_items">
            <!-- Dynamic project items will render here -->
            <div class="resume-item muted" data-placeholder-type="project">
              <div class="item-title">Project Title — Technologies Used</div>
              <div class="small-muted">Short description of project, impact, and a link (if any).</div>
            </div>
          </div>

          <div class="section-title">Skills & Certifications</div>
          <div id="r_skills_certs_section">
            <div class="resume-item" id="r_skills_technical"><b>Technical Skills:</b> Python • C • React</div>
            <div class="resume-item" id="r_skills_soft"><b>Soft Skills:</b> Teamwork • Communication</div>
            <div class="resume-item" id="r_skills_languages"><b>Languages:</b> English • Hindi</div>
            <div class="resume-item" id="r_certs_awards"><b>Certifications & Awards:</b> AWS Cloud Practitioner</div>
          </div>

        </div>
      </div>
    </div>
  </div>

  <script>
    // ---------- Utilities ----------
    const els = id => document.getElementById(id);

    // Initial Resume Data Structure
    let resumeData = {
        name: '',
        title: '',
        email: '',
        phone: '',
        location: '',
        links: '',
        summary: '',
        education: [], // Now an array for dynamic entries
        experience: [], // Now an array for dynamic entries
        projects: [], // Now an array for dynamic entries
        technicalSkills: '',
        softSkills: '',
        languages: '',
        certsAwards: '',
        templateSelect: 'classic'
    };

    // Placeholder content for empty fields
    const placeholders = {
        name: 'Your Name',
        title: 'Professional Title',
        summary: 'A brief summary about yourself, highlighting key skills and career goals.',
        educationTitle: 'University Name — Degree (Years)',
        educationDesc: 'CGPA, key coursework, relevant achievements.',
        experienceTitle: 'Role — Company (Dates)',
        experienceDesc: 'Main responsibilities and achievements\nQuantifiable results preferred',
        projectTitle: 'Project Title — Technologies Used',
        projectDesc: 'Short description of project, impact, and a link (if any).',
        technicalSkills: 'Python • C • React',
        softSkills: 'Teamwork • Communication',
        languages: 'English • Hindi',
        certsAwards: 'AWS Cloud Practitioner'
    };

    const STORAGE_KEY = 'enhanced_resume_builder_data_v2'; // Updated storage key

    // Helper to format text into bullet points if newlines are present
    function formatBulletPoints(text) {
        if (!text) return '';
        const lines = text.split('\n').filter(line => line.trim() !== '');
        if (lines.length > 0) {
            return `<ul>${lines.map(line => `<li>${line.trim()}</li>`).join('')}</ul>`;
        }
        return text;
    }

    // Function to update the preview from resumeData
    function updatePreview() {
        // Personal Details
        els('r_name').textContent = resumeData.name || placeholders.name;
        els('r_title').textContent = resumeData.title || placeholders.title;
        
        const contactParts = [];
        if (resumeData.email) contactParts.push(resumeData.email);
        if (resumeData.phone) contactParts.push(resumeData.phone);
        if (resumeData.location) contactParts.push(resumeData.location);
        if (resumeData.links) {
            const linkHtml = resumeData.links.split(',').map(link => {
                const trimmedLink = link.trim();
                if (!trimmedLink) return '';
                // Basic URL validation
                const urlRegex = /^(https?:\/\/(?:www\.|(?!www))[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|www\.[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|https?:\/\/[a-zA-Z0-9]+\.[^\s]{2,}|[a-zA-Z0-9]+\.[^\s]{2,})$/i;
                const displayLink = urlRegex.test(trimmedLink) ? new URL(trimmedLink.startsWith('http') ? trimmedLink : `https://${trimmedLink}`).hostname.replace('www.','') : trimmedLink;
                const fullLink = trimmedLink.startsWith('http') ? trimmedLink : `https://${trimmedLink}`;
                return `<a href="${fullLink}" target="_blank" rel="noopener noreferrer">${displayLink}</a>`;
            }).filter(Boolean).join(' • ');
            if(linkHtml) contactParts.push(linkHtml);
        }
        
        els('r_contact').innerHTML = contactParts.join("  •  ") || 'email • phone • location • links';
        els('r_summary').textContent = resumeData.summary || placeholders.summary;

        // Dynamic Sections: Education, Experience, Projects
        ['education', 'experience', 'projects'].forEach(sectionType => {
            const previewContainer = els(`r_${sectionType}_items`);
            previewContainer.innerHTML = ''; // Clear existing

            if (resumeData[sectionType].length === 0 || resumeData[sectionType].every(item => !item.title && !item.description)) {
                // Show placeholder if no items or all items are empty
                const placeholderDiv = document.createElement('div');
                placeholderDiv.className = 'resume-item muted';
                placeholderDiv.setAttribute('data-placeholder-type', sectionType);
                if (sectionType === 'education') {
                    placeholderDiv.innerHTML = `<div class="item-title">${placeholders.educationTitle}</div><div class="small-muted">${formatBulletPoints(placeholders.educationDesc)}</div>`;
                } else if (sectionType === 'experience') {
                    placeholderDiv.innerHTML = `<div class="item-title">${placeholders.experienceTitle}</div><div class="small-muted">${formatBulletPoints(placeholders.experienceDesc)}</div>`;
                } else if (sectionType === 'projects') {
                    placeholderDiv.innerHTML = `<div class="item-title">${placeholders.projectTitle}</div><div class="small-muted">${formatBulletPoints(placeholders.projectDesc)}</div>`;
                }
                previewContainer.appendChild(placeholderDiv);
            } else {
                resumeData[sectionType].forEach(item => {
                    if (item.title || item.description) {
                        const div = document.createElement('div');
                        div.className = 'resume-item';
                        let descContent = item.description ? formatBulletPoints(item.description) : '';

                        if (sectionType === 'education') {
                             div.innerHTML = `<div class="item-title">${item.title || placeholders.educationTitle}</div><div class="small-muted">${descContent || placeholders.educationDesc}</div>`;
                        } else if (sectionType === 'experience') {
                             div.innerHTML = `<div class="item-title">${item.title || placeholders.experienceTitle}</div><div class="small-muted">${descContent || placeholders.experienceDesc}</div>`;
                        } else if (sectionType === 'projects') {
                            div.innerHTML = `<div class="item-title">${item.title || placeholders.projectTitle}</div><div class="small-muted">${descContent || placeholders.projectDesc}</div>`;
                        }
                        previewContainer.appendChild(div);
                    }
                });
            }
        });

        // Skills & Certifications
        const rSkillsTechnical = els('r_skills_technical');
        rSkillsTechnical.innerHTML = resumeData.technicalSkills ? `<b>Technical Skills:</b> ${resumeData.technicalSkills.split(',').map(s=>s.trim()).filter(Boolean).join(' • ')}` : `<b>Technical Skills:</b> ${placeholders.technicalSkills}`;
        rSkillsTechnical.style.display = resumeData.technicalSkills ? 'block' : 'none';

        const rSkillsSoft = els('r_skills_soft');
        rSkillsSoft.innerHTML = resumeData.softSkills ? `<b>Soft Skills:</b> ${resumeData.softSkills.split(',').map(s=>s.trim()).filter(Boolean).join(' • ')}` : `<b>Soft Skills:</b> ${placeholders.softSkills}`;
        rSkillsSoft.style.display = resumeData.softSkills ? 'block' : 'none';

        const rSkillsLanguages = els('r_skills_languages');
        rSkillsLanguages.innerHTML = resumeData.languages ? `<b>Languages:</b> ${resumeData.languages.split(',').map(s=>s.trim()).filter(Boolean).join(' • ')}` : `<b>Languages:</b> ${placeholders.languages}`;
        rSkillsLanguages.style.display = resumeData.languages ? 'block' : 'none';

        const rCertsAwards = els('r_certs_awards');
        rCertsAwards.innerHTML = resumeData.certsAwards ? `<b>Certifications & Awards:</b> ${resumeData.certsAwards.split(';').map(s=>s.trim()).filter(Boolean).join(' • ')}` : `<b>Certifications & Awards:</b> ${placeholders.certsAwards}`;
        rCertsAwards.style.display = resumeData.certsAwards ? 'block' : 'none';

        // If all skill/certs are empty, hide the section title in preview
        const skillsCertsSectionTitle = rSkillsCertsSection.previousElementSibling; // This is the h3 before the skills section
        const hasSkillsCertsContent = resumeData.technicalSkills || resumeData.softSkills || resumeData.languages || resumeData.certsAwards;
        if (skillsCertsSectionTitle && skillsCertsSectionTitle.classList.contains('section-title')) {
             skillsCertsSectionTitle.style.display = hasSkillsCertsContent ? 'block' : 'none';
        }
    }

    // Function to render input fields for dynamic sections
    function renderDynamicInputs(sectionType) {
        const container = els(`${sectionType}Section`);
        const addButton = container.querySelector('.btn-add');
        // Clear all inputs before re-rendering, but keep the Add button
        container.querySelectorAll('.dynamic-item').forEach(item => item.remove());

        resumeData[sectionType].forEach((item, index) => {
            const div = document.createElement('div');
            div.className = 'dynamic-item';
            div.innerHTML = `
                <button type="button" class="btn-remove" data-section="${sectionType}" data-index="${index}"><i class="fas fa-times"></i></button>
                <label>${sectionType === 'education' ? 'Institution / Degree' : sectionType === 'experience' ? 'Role / Company' : 'Project Title'}</label>
                <input type="text" id="${sectionType}_${index}_title" data-section="${sectionType}" data-index="${index}" data-field="title" placeholder="${sectionType === 'education' ? 'e.g., University Name — Degree, 2021-2025' : sectionType === 'experience' ? 'e.g., Intern — Company, Jan-May 2025' : 'e.g., Resume Builder — HTML/CSS/JS'}" value="${item.title || ''}" />
                <label>${sectionType === 'education' ? 'Details / Achievements' : 'Description (use newlines for bullet points)'}</label>
                <textarea id="${sectionType}_${index}_description" data-section="${sectionType}" data-index="${index}" data-field="description" placeholder="${sectionType === 'education' ? 'CGPA, awards, key courses, 2-3 lines' : sectionType === 'experience' ? 'Developed X, leading
                :root{
      --bg:#f4f6fb;
      --card:#fff;
      --muted:#6b7280;
      --accent:#0f62fe;
      --shadow: 0 6px 18px rgba(11, 22, 39, 0.06);
      --max-width:1200px;
      --border-light: #e6e9ef;
      --border-dash: #eef2ff;
      --text-dark: #111827;
      --text-light: #f9fafb;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: "Open Sans", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background:var(--bg);
      color:var(--text-dark);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      padding:24px;
      display:flex;
      justify-content:center;
    }

    .app{
      width:100%;
      max-width:var(--max-width);
      display:grid;
      grid-template-columns: 420px 1fr;
      gap:20px;
      align-items:start;
    }

    /* LEFT: Form controls */
    .panel{
      background:var(--card);
      border-radius:12px;
      padding:18px;
      box-shadow:var(--shadow);
      height:calc(100vh - 48px);
      overflow-y:auto; /* Changed to auto for scrollbar only when needed */
      display:flex; /* Use flex for internal layout */
      flex-direction:column;
    }
    h2{margin:0 0 12px 0;font-size:20px; color:var(--accent)} /* Larger, accented title */
    .panel h3{font-size:16px; margin:20px 0 10px 0; color:var(--text-dark); border-bottom:1px solid var(--border-light); padding-bottom:8px;} /* Clearer section titles */
    label{display:block;font-size:13px;margin-top:10px;color:var(--muted); font-weight:600;} /* Bold labels */
    input[type="text"], input[type="email"], input[type="tel"], textarea, select{
      width:100%;
      padding:10px 12px;
      margin-top:6px;
      border-radius:8px;
      border:1px solid var(--border-light);
      font-size:14px;
      background: #fafbff;
      transition:border-color 0.2s, box-shadow 0.2s;
    }
    input[type="text"]:focus, input[type="email"]:focus, input[type="tel"]:focus, textarea:focus, select:focus{
      outline:none;
      border-color:var(--accent);
      box-shadow:0 0 0 3px rgba(15,98,254,0.1);
    }
    textarea{min-height:76px; resize:vertical;}
    .row{display:flex;gap:8px}
    .small{flex:1}
    .section{
      margin-top:14px;
      padding-top:12px;
      /* border-top:1px dashed var(--border-dash); */ /* Removed as h3 creates separation */
    }
    .controls{display:flex; gap:8px; margin-top:16px; flex-wrap:wrap; align-items:center;} /* Better spacing for buttons */
    button{
      padding:10px 14px;
      border-radius:8px;
      border:0;
      font-weight:600;
      cursor:pointer;
      transition:transform 0.1s ease, background 0.2s, color 0.2s, box-shadow 0.2s;
      display:inline-flex;
      align-items:center;
      gap:6px;
    }
    button:hover{transform:translateY(-1px);}
    .btn-primary{background:var(--accent); color:#fff; box-shadow:0 6px 14px rgba(15,98,254,0.12)}
    .btn-primary:hover{filter:brightness(0.95);}
    .btn-ghost{background:transparent; border:1px solid var(--border-light); color:var(--text-dark)}
    .btn-ghost:hover{background:var(--bg);}

    /* Dynamic section styling */
    .dynamic-item {
        background: #f9fbfd;
        border: 1px solid var(--border-light);
        border-radius: 8px;
        padding: 12px;
        margin-bottom: 12px;
        position: relative; /* For positioning remove button */
    }
    .dynamic-item-controls {
        display: flex;
        justify-content: flex-end; /* Align to right */
        gap: 8px;
        margin-top: 10px;
    }
    .btn-add {
        padding: 8px 12px;
        font-size: 13px;
        font-weight: 600;
        border-radius: 6px;
        cursor: pointer;
        border: 1px solid var(--accent);
        background: var(--card);
        color: var(--accent);
        transition: all 0.2s ease;
        margin-top:10px;
    }
    .btn-add:hover {
        background: #e9f0ff;
    }
    .btn-remove {
        position: absolute; /* Position relative to dynamic-item */
        top: 10px;
        right: 10px;
        padding: 4px 8px; /* Smaller padding */
        font-size: 11px;
        border-radius: 5px;
        cursor: pointer;
        border: 1px solid #fca5a5; /* Light red border */
        background: #fee2e2; /* Light red background */
        color: #ef4444; /* Red for remove */
        transition: all 0.2s ease;
        line-height: 1; /* Keep icon centered */
    }
    .btn-remove:hover {
        background: #fecaca; /* Slightly darker red on hover */
        border-color: #ef4444;
    }
    .btn-icon { /* Style for icon-only buttons */
      padding: 6px 8px;
      width: 30px;
      height: 30px;
      display: inline-flex;
      justify-content: center;
      align-items: center;
    }
    .btn-icon i {
      font-size: 14px;
    }

    /* RIGHT: Preview area */
    .preview-wrap{
      display:flex;
      flex-direction:column;
      gap:12px;
      height:calc(100vh - 48px);
      overflow:hidden; /* Prevent scrollbar on wrapper */
    }
    .preview-top{display:flex;justify-content:space-between;gap:8px;align-items:center}
    .preview{
      background:var(--card); padding:22px; border-radius:12px; box-shadow:var(--shadow); overflow-y:auto; flex:1; /* Only vertical scroll */
      min-height:640px;
      width:100%;
    }

    /* Template container common classes */
    .resume{
      width:210mm; /* A4 width for PDF */
      max-width:780px; /* Max width for preview */
      margin: 0 auto;
      color:var(--text-dark);
      background:transparent;
      min-height:297mm; /* Ensure it visually looks like A4 height */
      padding: 10mm; /* Internal padding for A4 */
    }
    .r-header{display:flex;align-items:center;gap:16px}
    .r-name{font-weight:700}
    .r-contact{font-size:13px; color:var(--muted); word-break: break-all;} /* Allow links to break */
    .r-contact a {color:var(--muted); text-decoration: none;}
    .r-contact a:hover {text-decoration: underline;}
    .section-title{margin-top:18px;font-weight:700;font-size:16px; padding-bottom:4px; border-bottom:1px solid var(--border-light); margin-bottom:10px;} /* Stronger section titles */
    .muted{color:var(--muted);font-size:13px}
    ul{margin:6px 0 0 20px; padding:0; list-style-type:disc;} /* Bullet points */
    ul li {margin-bottom:4px; padding-left: 0;} /* No extra padding for li */
    .item-title{font-weight:600; margin-bottom:2px;}
    .small-muted{font-size:13px;color:#6b7280; line-height:1.4;}
    .line{height:1px;background:#e6e9ef;margin:12px 0;border-radius:2px}

    .resume-item { margin-bottom: 12px; }
    .resume-item:last-child { margin-bottom: 0; }
    .resume-item.no-content { display: none; } /* Hide empty dynamic items in preview */

    /* TEMPLATE 1 — Classic (Times-like feel) */
    .tpl-classic{
      font-family: "Times New Roman", Times, serif;
    }
    .tpl-classic .r-name{font-size:28px}
    .tpl-classic .section-title{font-size:17px;border-bottom:2px solid #e6e9ef;padding-bottom:6px}
    .tpl-classic ul{list-style-type:circle;} /* Classic specific bullet style */

    /* TEMPLATE 2 — Modern (Open Sans) */
    .tpl-modern{
      font-family: "Open Sans", Arial, sans-serif;
      color:#0f1724;
    }
    .tpl-modern .r-name{font-size:26px; color:#0f1724}
    .tpl-modern .r-head{display:flex;justify-content:space-between;align-items:flex-start}
    .tpl-modern .section-title{color:var(--accent); border-bottom:none;}
    .tpl-modern ul{list-style-type:square;}

    /* TEMPLATE 3 — Elegant (Georgia) */
    .tpl-elegant{
      font-family: Georgia, "Times New Roman", serif;
      color:#111827;
    }
    .tpl-elegant .r-name{font-size:26px; border-bottom:1px solid var(--border-light); padding-bottom:5px; margin-bottom:5px;}
    .tpl-elegant .r-contact{margin-top:0 !important;}
    .tpl-elegant .section-title{font-size:16px; color:#374151; border-left:4px solid #374151; padding-left:8px; border-bottom:none;}
    .tpl-elegant ul{list-style-type:disclosure-closed;}

    /* TEMPLATE 4 — Creative (Poppins + color) */
    .tpl-creative{
      font-family: "Poppins", "Open Sans", sans-serif;
      color:#0b1020;
    }
    .tpl-creative .r-name{font-size:28px; color:#111827}
    .tpl-creative .header-accent{background:#f59e0b;padding:8px 12px;border-radius:8px;color:white;font-weight:700; display:inline-block; margin-bottom:10px;}
    .tpl-creative .section-title{color:var(--accent); border-bottom:2px solid var(--accent); padding-bottom:5px; margin-bottom:10px;}
    .tpl-creative ul{list-style-type:circle;} /* Use circle for creative */

    /* TEMPLATE 5 — Compact (Roboto, tighter spacing) */
    .tpl-compact{
      font-family: "Roboto", sans-serif;
      font-size:13px;
      color:#0f1724;
    }
    .tpl-compact .r-name{font-size:22px}
    .tpl-compact .section-title{font-size:14px;margin-top:10px; border-bottom:1px solid #ddd; padding-bottom:4px; margin-bottom:8px;}
    .tpl-compact ul{margin:4px 0 0 16px;}
    .tpl-compact .resume-item { margin-bottom: 8px; }


    /* small responsive tweaks */
    @media (max-width:980px){
      .app{grid-template-columns:1fr; padding-bottom:40px; gap:16px;}
      .panel{height:auto; max-height:600px; padding:16px; border-radius:8px;} /* Adjust max-height and padding */
      .preview-wrap{height:auto;}
      .preview{padding:16px; min-height:400px; border-radius:8px;}
      .resume{max-width:100%; width:100%; padding: 8mm;} /* Adjust A4 padding on small screens */
      body{padding:16px;}
      h2{font-size:18px;}
      .panel h3{font-size:15px;}
      button{padding:8px 12px; font-size:13px;}
      .btn-icon{width:28px; height:28px;}
      .btn-icon i{font-size:12px;}
    }
